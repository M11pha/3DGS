# CuNeRF

### Paper

#### Abstract

医学图像任意尺度超分辨率（MIASSR）最近受到了广泛关注，旨在通过单个模型以任意尺度对医学体积进行超级采样。然而，现有的 MIASSR 方法面临两个主要限制：==(i) 对高分辨率 (HR) 体积的依赖和 (ii) 泛化能力有限==，这限制了它们在各种场景中的应用。为了克服这些限制，我们提出了基于立方体的神经辐射场（CuNeRF），这是一种零样本 MIASSR 框架，能够在连续域中生成任意尺度和自由视点的医学图像。与仅适合低分辨率 (LR) 和 HR 体积之间映射的现有 MISR 方法不同，CuNeRF 专注于从每个 LR 体积构建连续的体积表示，而无需了解相应的 HR 体积。这是通过所提出的可微分模块来实现的：基于立方体的采样、各向同性体积渲染和基于立方体的分层渲染。通过广泛的磁资源成像（MRI）和计算机断层扫描（CT）模式的实验，我们证明 CuNeRF 可以合成高质量的 SR 医学图像，其性能优于最先进的 MISR 方法，实现更好的视觉逼真度和更少的不良伪影。与现有的 MISR 方法相比，我们的 CuNeRF 在实践中更适用。

#### 1. Introduction

计算机断层扫描 (CT) 和磁共振成像 (MRI) 等医学成像技术是辅助临床诊断的关键工具。然而，获取高质量的医学切片是一个资源密集型过程，需要受试者长期暴露于相当大的电离辐射下，增加终生患癌症的风险[21]。==为了减轻受试者的负担，一种可行的方法是从低分辨率（LR）医疗体重建高分辨率（HR）医疗体。==

随后，一系列方法[8,43,47,5,36]采用卷积神经网络来学习LR-HR映射。最近，医学图像任意尺度超分辨率（MIASSR）方法[28, 41]在 MISR 社区中受到了广泛关注，旨在采用单一模型对任意尺度的医学体积进行上采样。尽管这些方法取得了可接受的人力资源结果，但它们仍然存在两个主要问题：

==(i)现有的MIASSR方法依赖于人力资源卷的监督，但高质量的人力资源卷并不总是可用的==

==(ii) 这些方法可能容易受到训练数据和测试数据之间分布差距的影响，从而产生不存在的细节==

这些缺点限制了现有MIASSR方法的应用场景。

为了解决上述限制，我们提出了一个零样本 MIASSR 框架 - 基于立方体的 NeRF (CuNeRF)，其目的是在测试 LR 体积本身上进行训练后生成任意上采样图像（见图 2）。具体来说，我们从神经辐射场 (NeRF) [23] 中汲取灵感，==从离散样本（LR 体积）估计连续体积表示，而不是拟合 LR 和 HR 体积之间的映射。==

==由于直接将 NeRF 应用于医疗体积可能会导致网格状伪影==（参见图 3，第 4.1 节中提供了详细解释），因此我们的 CuNeRF 通过建议的可微分模块解决了此类混叠问题：基于立方体的采样、各向同性体积渲染和基于立方体的分层渲染。如图1所示，CuNeRF可以在训练数据中的坐标和相应强度值之间建立连续映射，从而能够在连续域中生成任意尺度和自由视点的医学切片。对 MSD 脑肿瘤 (MRI) [33] 和 KiTS19 (CT) [13] 数据集的综合实验表明，CuNeRF 在各种上采样尺度的 3D 和体积 MISR 中产生了令人印象深刻的性能，优于最先进的方法。主要贡献总结如下： 

• 据我们所知，CuNeRF 是第一个零样本 MIASSR 框架，可以以任意规模连续对医疗体进行上采样。  

• 我们通过所提出的技术解决了孔形成问题：基于立方体的采样、各向同性体积渲染和基于立方体的分层渲染。  

• 针对 3D MISR 和体积 MISR 的 CT 和 MRI 模式的大量实验表明，CuNeRF 明显优于最先进的 MIASSR 方法。

#### 4. Method

在本节中，我们首先分析 NeRF 在渲染医疗体积方面的局限性，并详细阐述我们的动机。
随后，基于我们的发现，我们提出了基于立方体的NeRF（CuNeRF），这是一种新颖而有效的处理“零样本”医学图像任意尺度超分辨率（MIASSR）的方法，扩展了NeRF在医学领域的应用场景。具体来说，我们首先通过体积归一化将医疗体积归一化到 [−1, 1] 的范围内，然后通过提出的可微模块训练模型：基于立方体的采样、各向同性体积渲染和基于立方体的分层渲染。
在训练过程中，CuNeRF 正在构建一个坐标强度连续函数，其输入是 3D 位置 x=(x, y, z)，输出是相应的像素值 c。经过优化后，CuNeRF可以预测范围内任意空间位置的像素。
因此，CuNeRF 能够通过输入相应的平面方程以自由视点和任意比例渲染医学切片。图 5 描绘了我们的 CuNeRF 的总体框架，后续技术将在以下小节中描述。

#### 4.1 Analysis & Motivation

如图 3 所示，NeRF 的采样策略可能不适合直接应用于医疗体，这可能会在结果中产生网格状伪影。为了解释这一限制，我们在图 4 (a) 中提供了应用于医疗体的 NeRF 建模策略的示例。**从视觉上看，NeRF 经过训练，可以沿着每个训练像素发出的光线对体积空间进行建模。由于医学体仅包含三个正交切片，这与传统相机采集的多视图照片不同，因此 NeRF 的建模技术无法覆盖整个表示域，从而在相邻训练像素之间的区域内留下一些“洞”（即未建模的空间）。**因此，NeRF 在渲染孔内的内容时可能会产生次优结果。如图 3 所示，NeRF†1 在上采样医疗体积中产生网格状伪影，这表明 NeRF 可能很难从相应的 LR 医疗体积中渲染高质量的 HR 医疗体积。

为了解决 NeRF 射线采样引起的孔洞形成问题，我们引入了基于立方体的采样，即对立方体（3D 体积空间）而不是射线（1D 空间）进行采样，以通过空间重叠来填充相邻训练像素之间的孔洞区域，如下所示如图 4 (b) 所示。为了适应基于立方体的采样，我们进一步提出了各向同性体积渲染和基于立方体的分层渲染模块。这些模块将在以下小节中介绍。

#### 4.2. Volumetric Normalization 体积归一化

$$
\|\hat{\mathbf{x}} - \hat{\mathbf{x}}_o\|_\infty = \max\left(|\hat{x} - \hat{x}_o|, |\hat{y} - \hat{y}_o|, |\hat{z} - \hat{z}_o|\right)

$$

